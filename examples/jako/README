This directory contains all of the scripts needed to build a PISM regional
of Jakobshavn Isbrae in Greenland, or another outlet glacier in that ice sheet,
from the SeaRISE 1km Greenland data.  This demonstrates the outlet-glacier-mode
PISM executable "pismo".

In order to run pismo some preprocessing must be performed.  A number
of python tools are needed.

* Get regional-tools, the drainage basin generator, by "git clone".  Then go
  to the new "regional-tools/" directory and set up this python tool as
  directed in README.md.  (Note that README.md lists the dependencies on 
  other python modules.)  Then come back here and link the tool we need.
  Here is the quick summary if all python dependencies are present:

  $ cd ~                                 # location where you want it
  $ git clone https://bueler@github.com/pism/regional-tools.git
  $ cd regional-tools/
  $ python setup.py install              # or add "--user" to build locally
  $ cd ~/pism/examples/jako/             # directory with current README
  $ ln -s ~/regional-tools/pism_regional.py .

* Now download and preprocess the SeaRISE data, an 80 Mb file:

  $ ./preprocess.sh

  A file gr1km.nc is created.  Look at what fields it contains:

  $ ncdump -h gr1km.nc                   # view metadata
  $ ncview gr1km.nc                      # view fields

* Now use pism_regional.py on gr1km.nc.  It opens a graphical user interface
  (GUI) which allows you to select a small rectangle around the flux gate or
  fjord which is the terminus of the outlet glacier you want to model.

  $ python pism_regional.py

  Now select "gr1km.nc" to open.  Once the topographic map appears
  in the Figure 1 window, select the button "Select terminus rectangle".
  Now use the mouse to select the small rectangle around the Jakobshavn
  terminus, for example.  Once it is a highlighted rectangle, click
  "Compute the drainage basin mask".  Because this is a large data set
  there will be some delay.  (Note that a parallel computation is done here.)
  Finally click "Save the drainage basin mask" and save with your
  preferred name; we will assume here that it is "jakomask.nc".

  FIXME: *  selecting rectangle slow/fragile?
         *  feedback on completion of steps should appear in GUI
              not in terminal?
         *  cutout command which appears at terminal can get lost?
         *  I have to hit "quit" twice to make it so

* The feedback from the above process includes a cutout command which
  appears as a global attribute of jakomask.nc.  Get it and use it:

  $ ncdump -h jakomask.nc |grep cutout

  Cut and paste the command, which applies to both the 1km Greenland data file
  and the mask file.  For example it will look like:

  $ ncks -d x,340,873 -d y,1015,1349 gr1km.nc jako.nc
  $ ncks -A -d x,340,873 -d y,1015,1349 jakomask.nc jako.nc   # append

  Now look at jako.nc.  This file is ready for a regional model.  The field
  ftt_mask has an identified drainage basin, outside of which we
  will not use a full model, but use simplified time-independent boundary
  conditions instead.  Specifically, outside of the ftt_mask area we will
  essentially keep the initial thickness, while inside the ftt_mask area all
  fields will evolve normally.

* What is the grid in jako.nc?

  $ ncdump -h jako.nc |head -n 5
  netcdf jako {
  dimensions:
	y = 335 ;
	x = 534 ;
  variables:

  Thus here is a native 1km one year run:
  
  $ mpiexec -n 4 pismo -boot_file jako.nc -Mx 534 -My 335 -no_model_strip 5 \
      -Lz 4000 -Lbz 1000 -Mz 201 -Mbz 51 -z_spacing equal \
      -atmosphere given -atmosphere_given_file jako.nc \
      -surface pdd,forcing -force_to_thk jako.nc \
      -sia_e 3.0 -y 1 -skip 50 -o jako1km_y1.nc -o_size medium

* To make real progress on a spinup we divide -Mx, -My by 3 to get a 3km grid:

  $ ./spinup3km.sh >> out.spin3km &
  


* TO DO:  get Dirichlet BCs from whole ice sheet run (presumably g5km_0.nc
  saved at pismdocs.org) for enthalpy, SSA.  The point for the former is that
  the only alternative is to have the enthalpy not spun-up at all in the no_model_strip,
  which then advects inward as an unrealistic temp.  The point for the SSA bc
  is that the alternative is to have zero velocity there while the velocity 
  tangent to the edge of the no_model strip, i.e. in westerly direction, is
  significantly nonzero (?).

FIXME from here



