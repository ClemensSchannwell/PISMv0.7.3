\documentclass[11pt,final]{amsart}

%% THE FOLLOWING SHOULD CHANGE FOR A STABLE RELEASE:
\newcommand{\PISMREV}{\textbf{trunk} revision \input{revision.tex}}
\newcommand{\PETSCREL}{2.3.3 or 3.0.0}
\newcommand{\PISMDOWNLOADMSG}{Get development version of PISM source code: \\ \centerline{\texttt{svn co http://svn.gna.org/svn/pism/trunk pism-dev}} \quad}

%\addtolength\topmargin{-.1in}
\addtolength\textheight{0.4in}
\addtolength{\oddsidemargin}{-.4in}
\addtolength{\evensidemargin}{-.4in}
\addtolength{\textwidth}{0.9in}
\newcommand{\normalspacing}{\renewcommand{\baselinestretch}{1.1}\tiny\normalsize}
\newcommand{\tablespacing}{\renewcommand{\baselinestretch}{1.0}\tiny\normalsize}
\normalspacing


% amsmidx (below) breaks if this is not defined :-(
\newcommand{\indexchap}{}
\usepackage{amsmidx}


\usepackage{bm,url,xspace,verbatim}
\usepackage{amssymb,amsmath}
\usepackage[pdftex]{graphicx}
\usepackage[pdftex]{hyperref}
\usepackage{longtable}
\usepackage[usenames]{color}

%% uncomment to see locations of index entries
%\usepackage{showidx}

\usepackage{underscore}


\newcommand{\ddt}[1]{\ensuremath{\frac{\partial #1}{\partial t}}}
\newcommand{\ddx}[1]{\ensuremath{\frac{\partial #1}{\partial x}}}
\newcommand{\ddy}[1]{\ensuremath{\frac{\partial #1}{\partial y}}}
\renewcommand{\t}[1]{\texttt{#1}}
\newcommand{\Matlab}{\textsc{Matlab}\xspace}
\newcommand{\bq}{\mathbf{q}}
\newcommand{\bU}{\mathbf{U}}
\newcommand{\eps}{\epsilon}
\newcommand{\grad}{\nabla}
\newcommand{\Div}{\nabla\cdot}

%% macros having to do with documentation for options; note these appear in the index

\newcommand{\optindexsection}{PLEASE REDEFINE optindexsection}
\newcommand{\pismoptionindex}[1]{\index{options}{\textbf{\optindexsection}!\texttt{-#1}}}

% Use this to index option definitions:
\newcommand{\intextoption}[1]{\texttt{-#1}\pismoptionindex{#1}}

%\newcommand{\rawopt}[1]{\vspace{1mm}\noindent \large\texttt{-#1}\normalsize\pismoptionindex{#1}\alphaoptionindex{#1}}
\newcommand{\rawopt}[1]{\vspace{1mm}\noindent \Large\texttt{-#1}\normalsize\pismoptionindex{#1}}
\newcommand{\opt}[1]{\rawopt{#1}\,:\quad}
\newcommand{\optdef}[2]{\rawopt{#1}\,[\textsl{#2}]:\quad}
\newcommand{\optrestrict}[2]{\rawopt{#1}\,[\texttt{#2} \textsl{only}]:\quad}
\newcommand{\optdefrestrict}[3]{\rawopt{#1}\,[\textsl{#2}]\,[\texttt{#3} \textsl{only}]:\quad}


% preamble:

\makeindex{general}
\makeindex{options}

\newcommand{\ind}[1]{\index{general}{#1}}

\title[PISM User's Manual]{\protect{\Large \emph{PISM}, a Parallel Ice Sheet Model:\normalsize} \\ \protect{\Large \bigskip \bigskip User's Manual\normalsize}}

\author[]{Ed Bueler \\ Constantine Khroulev \\ Andy Aschwanden \\ Jed Brown \\ Nathan Shemonski}

\date{\today.  Support by email: \texttt{help\@@pism-docs.org}.  Based on PISM \PISMREV\,and PETSC release \PETSCREL. \PISMDOWNLOADMSG}

\pdfinfo{
/Title (PISM User's Manual)
/Author (Ed Bueler and Constantine Khroulev and Andy Aschwanden and Jed Brown and Nathan Shemonski)
/Subject (Using PISM, a Parallel Ice-Sheet Model)
/Keywords (PISM ice sheet modeling)
}

\begin{document}
\graphicspath{{figs/}}

\maketitle
\thispagestyle{empty}

\vspace{2.0in}
\begin{center}
\includegraphics[width=2.5in,keepaspectratio=true]{greencbar-SSL2}\, \includegraphics[width=3.2in,keepaspectratio=true]{rossquiver}
\end{center}

\newpage
\phantom{bob}
\vspace{1.0in}
\begin{quote}
\textsl{Copyright (C) 2004--2010 Ed Bueler and Constantine Khroulev and Andreas Aschwanden and Jed Brown and Nathan Shemonski}
\medskip

\noindent \textsl{This file is part of PISM.}
\medskip

\noindent \textsl{PISM is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.  PISM is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more details.  You should have received a copy of the GNU General Public License\ind{GPL (\emph{GNU Public License})} along with PISM; see \emph{\texttt{COPYING}}.  If not, write to the Free Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA}
\end{quote}
\vspace{0.6in}
\normalspacing


\centerline{\textsc{Acknowledgements}}
\bigskip

\small
The NASA Modeling, Analysis, and Prediction program\ind{NASA!Modeling, Analysis, and Prediction Program} (grant \# NNX09AJ38G) supports the development of PISM from 2009 to 2013.  We thank them!  Development from 2002 to 2008 was supported by the NASA Cryospheric Sciences Program\ind{NASA!Cryospheric Sciences Program}.

The Snow, Ice, and Permafrost (SIP) group\ind{Geophysical Institute!Snow, Ice, and Permafrost group} at the Geophysical Institute at UAF is now the home for PISM developers.  Find us in Elvey 410D, in a corner office facing the wilds of Alaska.

The Arctic Region Supercomputing Center\ind{Arctic Region Supercomputing Center (ARSC)} has provided significant computational resources and technical help in the development of PISM.

Our research into ice sheet modeling was strongly influenced and constantly motivated by Craig Lingle\ind{Lingle, Craig}.  Dave Covey, Don Bahls, and Greg Newby have supported our computers, tools, and and computations.  Martin Truffer, Regine Hock, Dani DellaGiustina and others in the SIP group provide the real-glaciology context for PISM at UAF.  Thanks to Tolly Adalgeirsdottir, Torsten Albrecht, Nick Golledge, Marianne Hasselhoff, Tore Hattermann, Jesse Johnson, Anders Levermann, Art Mahoney, David Maxwell, Maria Martin, Kent Overstreet, Ben Sperisen, Ward van Pelt, Ricarda Winkelmann, Ryan Woodard, Florian Ziemen and other PISM users/developers for helpful comments and questions on PISM and this \emph{Manual}.
\normalsize

\newpage
\setcounter{tocdepth}{2}
\small
\tableofcontents
\normalsize

\newpage
\section{Introduction}\label{sect:intro}

Welcome!  All information about PISM is online at
\begin{center}
  \href{http://www.pism-docs.org}{\t{www.pism-docs.org}}
\end{center}

This \emph{User's Manual} describes how to run PISM using certain publicly-available data for the Greenland ice sheet and the Ross ice shelf.  It illustrates how PISM's numerical approximations are verified.  It documents all the PISM options.  But it does not explain PISM internals, nor is it a guide for extending the functionality of PISM.

See the \emph{Installation Manual} for how to download\ind{PISM!download source code} the PISM source code and install it\ind{PISM!install}, along with needed libraries.  It is online at
   \begin{center}
     \href{http://www.pism-docs.org/dev/pdfs/installation-dev.pdf}{\t{www.pism-docs.org/dev/pdfs/installation-dev.pdf}}
   \end{center}

Users who want to understand how PISM works, extend PISM, and/or generally advance the science of ice sheets will need to go beyond what is described here.  For such users there is a \emph{C++ Class Browser}\ind{PISM!\emph{C++ Class Browser (HTML)}}.  It gives a complete view of the class/object structure of the PISM source code.  It is the best tool for the job of modifying and supplementing PISM by writing derived classes.  It is online at
   \begin{center}
     \href{http://www.pism-docs.org/dev/doxy/html/index.html}{\t{www.pism-docs.org/dev/doxy/html/index.html}}
   \end{center}
  

\vspace{1.0in}
\large
\begin{center}
\framebox{\parbox{5.0in}{ \emph{WARNING}:\ind{PISM!warning}  PISM is an ongoing project.  Ice sheet modeling is complicated and is generally not mature.  Please don't trust the results of PISM or any other ice sheet model without a fair amount of exploration.  Also, please don't expect all your questions to be answered here.  Write to us with questions at \href{mailto:help@pism-docs.org}{\texttt{help@pism-docs.org}}.} }
\normalsize
\end{center}
\normalsize


\clearpage\newpage
\input{getting-started.tex}


\clearpage
\newpage
\section{Ice dynamics, the PISM view}\label{sect:dynamics}

\subsection{PISM design principles}\ind{PISM!principles}  This section gives an overview of ice dynamics models in PISM.  First we list some high-level organizing principles:
\begin{enumerate}
\item source code is open, free, and works well with other free software tools,
\item numerical methods should be verifiable (i.e.~we want comparisons to exact solutions of the modeled equations),
\item shallow models are (currently) the most effective at whole ice sheet scale,
\item comparing results from a hierarchy of ice dynamics simplifications is more important than getting them from any particular set of dynamical equations,
\item everything computed diagnostically (instantaneously) is available prognostically (i.e.~it can evolve in time),
\item climate inputs affect ice dynamics by a well-defined interface, and
\item science is better if done with publicly-available data.
\end{enumerate}

\noindent We do not claim to follow these principles perfectly, but we hope that any user can see these principles reflected in PISM and this \emph{Manual}.

Principle (1) is illustrated by our existence.  Principle (2) is addressed in section \ref{sect:verif}.  Principle (7) is illustrated by examples in sections \ref{sec:eismint-greenland} and \ref{sect:ross} (FIXME: and the new introduction).  Principles (3), (4), (5), and (6) are explained and expanded next.


\subsection{Two main shallow models, SIA and SSA}\ind{PISM!SIA}\ind{PISM!SSA}  At each time-step of a typical PISM runs, the geometry, temperature, and basal strength of the ice sheet are included into stress balance equations to determine the velocity of the flowing ice.   PISM can, however, numerically solve two significantly-different shallow approximations of the full stress balance equations\footnote{The ``full stress balance equations'' form the Stokes model for slowly-flowing fluids \cite{Fowler}, in this case a non-Newtonian fluid, and they are themselves an inertia-free approximation of the conservation of momentum equations.}:\begin{itemize}
\item the non-sliding shallow ice approximation (SIA)\ind{SIA (shallow ice approximation)} \cite{Hutter}, which describes ice as flowing by shear in planes parallel to the geoid, with an infinitely-strong contact of ice base to bedrock, and
\item the shallow shelf approximation (SSA)\ind{SSA (shallow shelf approximation)} \cite{WeisGreveHutter}, which describes a membrane-type flow of floating ice \cite{Morland}, or grounded ice which is sliding over a weak base \cite{MacAyeal,SchoofStream}.
\end{itemize}
PISM numerically solves both the SIA and SSA equations in parallel.  Time-stepping solutions of the mass continuity equation are possible when using each model.

The SIA\ind{SIA (shallow ice approximation)!applicability} equations are, as a rule, easier and quicker to numerically solve than the SSA, and they are also easier to parallelize.\ind{parallelization!relative ease of, between SIA and SSA}  They are a ``lubrication approximation'' \cite{Fowler} which describes the shear as a local function of the driving stress of classical glaciology \cite{Paterson}.  They can confidently be applied to those grounded parts of ice sheets for which the basal ice is frozen to the bedrock, or minimally sliding, and for which the bed topography is relatively slowly-varying in the map-plane \cite{Fowler}, which roughly characterizes the majority (by area) of the Greenland and Antarctic ice sheets.  We recommend solving the SIA with a \emph{non-sliding} base because the ad hoc addition of a ``sliding laws''\ind{SIA (shallow ice approximation)!sliding laws} into the SIA stress balance, and especially schemes which ``switch on'' at the pressure-melting temperature \cite{EISMINT00}, have bad continuum and numerical modeling consequences \cite[appendix B]{BBssasliding}.

The SSA\ind{SSA (shallow shelf approximation)!applicability} equations can confidently be applied to large floating ice shelves, which have small depth-to-width ratio and negligible basal resistance \cite{Morland,MorlandZainuddin}.  Terrestrial ice sheets also have fast-flowing grounded parts, however, called ``ice streams'' or ``outlet glaciers''.  Such features appear at the margin of, and sometimes well into the interior of, the Greenland \cite{Joughinetal2001}\ind{Greenland ice sheet} and Antarctic \cite{BamberVaughanJoughin}\ind{Antarctic ice sheet} ice sheets.  Describing these faster-flowing grounded parts of ice sheets requires something more than the non-sliding SIA.  One might use the full Stokes equations, or a ``higher-order'' but still shallow stress balance \cite{Blatter,Pattyn03}, but with any stress balance model one must still specify an appropriate sliding boundary condition.  To address these faster-flowing parts, one may apply the SSA equations with additional basal resistance terms to model fast-flowing and sliding grounded ice.  This was demonstrated for the Siple Coast ice streams of Antarctica by MacAyeal\ind{MacAyeal, Doug} \cite{MacAyeal} using a linearly-viscous model for the underlying till.  A free boundary problem with the same (SSA) balance equations is the Schoof\ind{Schoof, Christian} \cite{SchoofStream} model of ice streams, in which ice streams appear where there is plastic basal till failure \cite{Paterson}.

As noted, both the SIA and SSA models are \emph{shallow} approximations.  That is, the respective partial differential equations are derived from the Stokes equations by different small-parameter arguments, both based on a small depth-to-width ratio for the ice sheet.\footnote{For this small-parameter argument in the SIA case see \cite{Fowler}.  For the corresponding SSA argument, see \cite{WeisGreveHutter} or the appendices of \cite{SchoofStream}.  See \cite{SchoofHindmarsh} on connections between these shallowest models and ``higher order'' models.  The references are, of course, the right place to find continuum equations and their physical motivation.}

In PISM the SSA may be used as a ``sliding law'' for grounded ice otherwise modeled by the SIA, and the resulting model is recommended \cite{BBssasliding,BKAJS}.  This role for the SSA is in addition to its obvious role in ice shelf modeling.  In brief, our concept for grounded ice is that we balance the membrane stresses which become important when there is sliding.  These stresses are especially important near spatial (and temporal) changes in basal strength.  Similar concerns at the ``grounding line'', where ice flows into a floating ice shelf, also suggest that membrane stresses on the grounded side of the grounding line are worth including.

By default, PISM does not numerically solve the SSA at all.  The user must add the option \intextoption{ssa} (FIXME).  An exception is the use of the executable \texttt{pismv} for verifying the SSA balance of momentum equations, as addressed in section \ref{sect:verif}.


\subsection{A hierarchy of simplifying assumptions for ice flow}\label{sec:model-hierarchy}\ind{PISM!hierarchy of simplifying assumptions}   Table \ref{tab:modelhierarchy} describes a hierarchy of models which are implemented in PISM or are planned.  This hierarchy is listed in order of increasing effectiveness in modeling grounded ice sheets with fast flow features.  It is also listed in order of increasing need for data to serve as boundary and initial conditions, an important consideration for the scientific user.

\begin{table}[ht]
\caption{Hierarchy of current and planned flow models in PISM, for the grounded parts of ice sheets, from most to fewest simplifying assumptions \emph{and} from least to greatest need for boundary data.  The \emph{italicized} models are planned for future versions of PISM but are not implemented in \texttt{stable0.3}.}\label{tab:modelhierarchy} 
\small
\begin{tabular}{p{0.25\linewidth}p{0.45\linewidth}p{0.35\linewidth}}\hline
\textbf{Model} & \textbf{Assumptions [references]} & \textbf{Needed initial/boundary data} \\ \hline
\emph{balance velocities}\tiny[planned]\small & steady state, ice flows down surface gradient \cite{JoughinetalGrBal97} & surface mass balance, ice  thickness, bed elevation \\
\textsc{isothermal SIA} & non-sliding lubrication flow, fixed softness \cite{BLKCB,EISMINT96} & same, with time-dependence \\
\textsc{thermo-coupled SIA} & non-sliding lubrication flow, temperature-dependent softness \cite{BBL,EISMINT00} & same, plus surface temperature,  geothermal flux \\
\textsc{polythermal SIA} & same, but allowing liquid water in the temperate ice matrix and conserving energy more completely \cite{AschwandenBlatter,Greve} & same, plus surface liquid water fraction if available \\
\textsc{SIA + SSA hybrid} & SSA as a sliding law for thermo-coupled SIA \cite{BBssasliding} & same, plus basal layer (till) strength \\
\emph{Blatter-Pattyn} \tiny[planned]\small & ``higher-order'', bridging stresses \cite{Blatter,Pattyn03,SchoofCoulombBlatter} & same \\ \hline
\end{tabular}
\normalsize
\end{table}

As an additional row one might list ``full Stokes'' in Table \ref{tab:modelhierarchy}.  That stress balance is \emph{not} planned for PISM at any time, however, as its numerical solution requires a fundamentally different computational architecture.

It makes sense to also talk about an \emph{ice shelf} model hierarchy, and even about a special hierarchy of models for the transition from grounded to floating ice \cite{SchoofMarine1}, but this would take us too far afield.  Currently, ice shelves should always be modeled by the SSA equations in PISM.


\subsection{Evolutionary versus diagnostic ice shelf modeling} \label{subsect:basicmodes}\ind{PISM!evolution run}\ind{PISM!diagnostic run}    The main goal of a numerical ice sheet model like PISM is to be a dynamical system which evolves over time as similarly as possible to the modeled ice sheet.  Such a goal assumes one has the right climate inputs and parameter choices at each time step.  For predictive purposes, such a goal also assumes one starts with the right initial conditions, adequately describing the present state of the ice sheet, though in fact thiss last assumption is rarely satisfied; see section \ref{sect:boot}.

Underlying an ice sheet model like PISM are evolution-in-time partial differential equations.  PISM solves these by taking small time steps.\footnote{``Small'' time steps vary from hundredths to many model years, depending primarily on both grid resolution and modeled ice flow speed.  Time steps are chosen adaptively in PISM, according to the stability criteria of the several numerical methods.}  We will describe this usual time-stepping behavior as an ``evolution run.''

Much ice flow modeling, especially of streams and shelves, uses only instantaneous ``diagnostic'' solution of the partial differential equations which determine the velocity field.  The existence of such ``instantaneous'' velocity fields follows from the slowness of the ice, which implies that inertia can be neglected in the stress balance \cite{Fowler}.  The goal of a ``diagnostic run'' is usually to compute the velocity field, including the instantaneous rate of surface movement in particular.  This will be our definition of ``diagnostic run'' from now on.

Sections \ref{sec:eismint-greenland} and \ref{sect:ross} illustrate the evolutionary and diagnostic modeling modes of PISM, respectively.  The first of these describes time-stepping evolution models for the Greenland ice sheet while the second describes a diagnostic SSA model for the Ross ice shelf.

\subsection{Climate inputs and their separation from ice dynamics}
\label{sec:climate-inputs}  This section applies the sixth PISM organizing principle above (section \ref{sect:dynamics}): \emph{climate inputs affect ice dynamics by a well-defined interface}.

Because PISM's job is to approximate ice flow, its world view is centered around ice dynamics, boundary conditions it required to model dynamics, and the corresponding interfaces.  Figure~\ref{fig:climate-inputs} is an illustration emphasizing that the ice sheet has a top surface interface (green dashed line in the figure) separating it from a surface (snow, firn, melt\dots) processes layer.  This latter layer covers the whole surface of the ice, \emph{including ablation areas} and ice-free bedrock.

As described in section \ref{subsect:beddef}, PISM includes an optional bed
deformation component approximating the movement of the Earth's crust and upper
mantle in response to changing ice load. Also, the temperature of the layer of
bedrock in contact with grounded ice is included in the conservation of energy
model. In this sense everything below the black dashed line (i.e. ice and
bedrock) is ``owned'' by PISM, which adds two more interfaces:
sub-ice-shelf/ocean (shown in blue) and the bottom of the bedrock thermal layer
(not shown).

\begin{figure}
  \centering
  \includegraphics[width=5in]{figs/climate-cartoon-new.pdf}
  \caption{PISM's view of interfaces between an ice sheet and the outside world}
  \label{fig:climate-inputs}
\end{figure}

\begin{table}[h]
  \centering
  \begin{tabular}{p{0.35\linewidth}p{0.55\linewidth}}\\
    \hline
    \textbf{Boundary} & \textbf{Necessary conditions}\\
    \hline
    Top ice surface (below firn) (\textcolor{green}{green})& Ice temperature (or enthalpy) and mass flux into the ice\\
    Bottom surface of the thermal bed layer (not shown) & Geothermal flux\\
    Bottom ice shelf surface (\textcolor{blue}{blue})& Mass flux into the ocean\\
   \hline
  \end{tabular}
  \caption{Boundary conditions required by PISM's ice dynamics core; see figure
  \ref{fig:climate-inputs}}
  \label{tab:ice-dynamics-bc}
\end{table}

Table \ref{tab:ice-dynamics-bc} lists boundary conditions required at
interfaces mentioned above.\footnote{This is a somewhat simplified view  corresponding to a ``generic'' PISM run.   See section \ref{sec:model-hierarchy} for details.}  The PISM ice dynamics core would like to be able to get these fields directly from observations/measurements, or directly from a GCM.  Unfortunately in most realistic modeling situations they are not so easily available.\footnote{Including cases where PISM is coupled to a GCM---due to differences in model resolutions and required down-scaling.}.

So, to be able to use data that \emph{is} available, an ice-sheet model has to
have additional components that are responsible for modeling surface (snow)
processes or sub-shelf/ocean interaction.  Sometimes these components merely turn data that we already have into data in the right units and with the right metadata so that PISM knows what to do with those data.

Thus we have PISM's design: the ice-dynamics-and-earth-deformation PISM
core does not contain any parameterization or other model for boundary mass or
energy balance.  This simplifies customizing and debugging PISM's climate
inputs, promotes code reuse and isolates the code that needs to be changed to
couple PISM to a climate model.

Users wishing to customize PISM's climate inputs should see the \emph{PISM
  Source Browser}, e.g.~at
\url{http://www.pism-docs.org/dev/doxy/html/index.html} and the documentation
of \emph{PISMSurfaceModel}, \emph{PISMAtmosphereModel} and
\emph{PISMOceanModel} therein.  Also, section \ref{sec:eismint-greenland} describes a
modeling example using a non-standard air temperature parameterization. Looking
at \texttt{pgrn.cc} and \texttt{pgrn\_atmosphere.cc} may be a reasonable
start.

Note that figure~\ref{fig:climate-inputs} includes an interface that was not
mentioned yet, the one between the surface layer and the air (red dashed line).
Unlike the ones listed in table~\ref{tab:ice-dynamics-bc}, this interface
\emph{may not even be present in some PISM configurations:} the ice dynamics
core of PISM only ``knows'' about mediums bordering ice and bedrock. A pair
consisting of a ``PISM surface model'' and an ``PISM ocean model'' may be
hiding anything from a nearly trivial parameterization of ice surface
temperature plus surface and sub-shelf mass fluxes to a GCM of great
complexity.

Figure~\ref{fig:climate-input-data-flow} illustrates the corresponding data
flow \emph{into} the PISM core; the data flow in the other direction depends on
particular modeling choices.

This figure requires an explanation: a ``modifier'' in this context is an
adjustment of climate inputs that can be used with different climate
choices.  Using ice-core derived air temperature offsets is an example: instead
of having a ``Greenland model'' implementing temperature offsets and an
``antarctic'' model, also implementing them, PISM has a generic ``forcing''
mechanism that can be paired with another model. Please see section \ref{sec:boundary-models} for
a list of ``climate'' components included in PISM source code and other details.

\begin{figure}
  \centering
  \includegraphics[width=5in]{figs/data-flow.pdf}
  \caption{PISM climate input data flow. Colored arrows correspond to interfaces in
    figure \ref{fig:climate-inputs}.}
  \label{fig:climate-input-data-flow}
\end{figure}

Why describe this structure here? On the one hand, some users may be interested
in coupling PISM to other models. On the other hand, the PISM authors do not
claim expertise in modeling atmosphere, ocean, or even snow processes.   So the
separation has a code-reliability purpose. Indeed PISM users need to know that
they are ultimately responsible for providing the climate inputs they intend.
The auxiliary tool \texttt{pcctest}, described in subsection
\ref{subsect:pcctest}, is intended to help users observe the climate inputs
they have chosen, without involving ice dynamics at all.

\clearpage
\newpage
\section{Initialization and bootstrapping}\label{sect:boot}  

\subsection{``Initialization from a saved model state''}  This phrase\ind{initialization!from saved model state} has a simple meaning in PISM.  If a previous PISM run has saved a NetCDF file using ``\texttt{-o}'' then that file will contain complete initial conditions for continuing the run.  The output file from the last run can be loaded with ``\intextoption{i}'':\ind{pisms}

\begin{verbatim}
$ pisms -eisII A -y 100 -o foo.nc
$ pisms -eisII A -i foo.nc -y 100 -o bar.nc
\end{verbatim}
\smallskip

Note that simplified-geometry experiments (section \ref{sect:simp}) and verification tests (section \ref{sect:verif}) do not need input files at all because they initialize from formulas in the source code.  They can be continued from saved model states using \texttt{-i}.  As in the above example, however, specifying the simplified geometry experiment or verification test \emph{is} necessary, so that the run can continue with the climate inputs for that experiment or test.  For instance, it is an error to replace the second line above with ``\verb|$ pisms -i foo.nc -y 100 -o bar.nc|''.  It is valid to do ``\verb|$ pismr -i foo.nc -y 100 -o bar.nc|'' but the climate and other parameters default to the core PISM default values, and thus not (necessarily) the values specified in EISMINT II.

As a technical but important note about saved states, a PISM run with \intextoption{ssa}
also saves the last SSA velocities to the output file, in variables 
\texttt{vubarSSA} and \texttt{vvbarSSA}.  A \texttt{ssa_velocities_are_valid} global
attribute shows if the data present in these variables is valid.  The presence
of these velocities adds efficiency in restarting.  If you want a PISM restart to
ignore these velocities use \intextoption{dontreadSSAvels}.

\subsubsection*{\texttt{-i} file format}
PISM produces CF-1.4 compliant NetCDF\ind{PISM!NetCDF file format}\ind{NetCDF} files.  The easiest way to learn the output format \emph{and} the \texttt{-i} format is to do a simple run and then look at the metadata in the resulting file, like this:
\begin{verbatim}
$ pisms -eisII A -y 10 -o foo.nc
$ ncdump -h foo.nc | less
\end{verbatim}

Note that variables have a \texttt{pism_intent}\ind{PISM!\texttt{pism\_intent} attribute} attribute.  When that attribute is \texttt{diagnostic}, the variable can be deleted from the file without affecting whether PISM can use it as a \texttt{-i} input file.  Variables with \texttt{pism_intent} = \texttt{model_state}, by contrast, must be present for use with \texttt{-i}.

Regarding the automatically produced time variable, which has a \texttt{units} attribute like \texttt{"years since 1-1-1"}, note that CF metadata conventions require using a reference date in the units string of a time (\texttt{t}) variable.  PISM completely ignores this reference date.


\subsection{``Bootstrapping''} 
\renewcommand{\optindexsection}{Bootstrapping}

This phrase\ind{bootstrapping}\ind{initialization!by bootstrapping} means starting a modeling run with less than sufficient data, and letting the model fill in needed values according to heuristics.  These heuristics are applied before the first time step is taken, so they are part of an initialization process.  Bootstrapping uses the option \intextoption{boot\_from}.

The need for an identified stage like ``bootstrapping'' comes from the fact that initial conditions, for the evolution equations describing an ice sheet, are not typically observable.  As a principal example of this problem, these equations require the temperature within the ice at the time the run is started.  Glaciological observations, specifically remote-sensed observations which cover a large fraction or all of an ice sheet, never include this temperature field in practice.

Instead, evolutionary ice sheet modeling necessarily does something like this to get ``reasonable'' initial fields within the ice: \begin{enumerate}
\item start only with observable quantities like surface elevation, ice thickness, and ice surface temperature,
\item ``bootstrap'' as defined here, using heuristics to fill in temperatures at depth and to give a preliminary estimate of the basal sliding condition, and thus of the three-dimensional velocity field, and
\item \emph{either} do a long run holding the current geometry and surface temperature steady,  to evolve toward a ``more physical'' steady state which will have compatible temperature field, velocities, and age field,
\item \emph{or} do a long run using an additional spatially-imprecise historical record from an ice core or a sea bed core (or both), to apply forcing to the surface temperature or sea level (for instance), but with the same functional result of filling in a temperature, velocity, and age.
\end{enumerate}

The heuristics used by PISM are, for now, only documented in the source code file \texttt{src/base/iMbootstrap.cc}.

When using \intextoption{boot\_from} you will need to specify both grid dimensions (using \intextoption{Mx}, \intextoption{My} and \intextoption{Mz}) and the height of the computational box for the ice with \intextoption{Lz}.  The data read from the file can determine the horizontal extent of the model, if options \intextoption{Lx}, \intextoption{Ly} are not set.  The additional specification of vertical extent by \texttt{-Lz} is reasonably natural because realistic data used in ``bootstrapping'' are two-dimensional.  Not specifying all four options \texttt{-Mx}, \texttt{-My}, \texttt{-Mz}, \texttt{-Lz} \emph{when bootstrapping with} \texttt{-boot_from} is an error.

Subsection shows bootstrapping for the \ref{sec:eismint-greenland} does EISMINT-Greenland intercomparison \cite{RitzEISMINT,HuybrechtsEISMINT}.

\subsubsection*{\texttt{-boot\_from} file format}
\label{sec:bootstrapping-format}  Allowed formats for a bootstrapping file are relatively simple to describe. 
\begin{enumerate}
\item The NetCDF dimensions \texttt{x} and \texttt{y} and corresponding variables must be present and have the meanings of projection X coordinate and projection Y coordinate.
\item Coordinate variables \texttt{x} and \texttt{y} have to be strictly increasing.
\item All three-dimensional variables (depending on \texttt{x,y,z} or \texttt{x,y,zb}) will be ignored in bootstrapping.
\item The \texttt{standard_name} attribute is used to identify a variable, so the names of variables do not need to match the corresponding variables in a PISM output file.
\item PISM expects all the input fields (NetCDF variables) to be in MKS \emph{or} to have the units specified using the \texttt{units} attribute.  PISM uses a library called UDUNITS\ind{PISM!uses UDUNITS when reading NetCDF files}\ind{UDUNITS} to convert data present in an input file to MKS.   This means that having ice thickness in feet or kilometers, or temperature in Celsius for example, is allowed.
\item Any two-dimensional variable (depending on \texttt{x,y}) may be missing.  For those missing variables some heuristic will be applied.  See table \ref{tab:modelhierarchy} for a sketch of the data necessary for bootstrapping, and \texttt{src/base/iMbootstrap.cc} for all further details.
\item Surface elevation is ignored if present.  Users with surface elevation and bed elevation data should produce an ice thickness variable, with \texttt{standard_name} = \texttt{land_ice_thickness} for bootstrapping.  The bed elevation (topography) is read by \texttt{standard_name} = \texttt{bedrock_altitude}.
\end{enumerate}

\subsection{Initialization sequence}  As described already, there are three ways to start PISM,\begin{itemize}
\item executables \texttt{pisms} and \texttt{pismv} initialize experiments and verification tests, respectively, from formulas in the source code,
\item \texttt{-i} reads a previously-saved PISM model state in NetCDF form, and
\item \texttt{-boot_from} reads a NetCDF file and uses heuristics to fill in needed fields.
\end{itemize}
As a consequence of these options, and generally from the complexity of getting a computation started on a parallel computer, we observe that initializing PISM is one of the most error-prone parts of maintaining it.

Thus initialization sequence is also an error-prone part of writing a derived class of \texttt{IceModel} to modify PISM's function.  The reader interested in doing so should see method \texttt{IceModel::init()} and also view the flow chart in \texttt{doc/initialization-sequence.png}.  Note that \texttt{init()} is \emph{not} \texttt{virtual}.  Derived classes can redefine the several methods which are called by \texttt{init()}, which are \texttt{virtual}.


\clearpage\newpage
\input{modeling-choices.tex}

\clearpage\newpage
\input{practical-usage.tex}

\clearpage\newpage
\input{verification.tex}

\clearpage\newpage
\input{simplified-geometry.tex}

\clearpage\newpage
\input{eismint-greenland.tex}

\clearpage\newpage
\input{eismint-ross.tex}


%         References
\clearpage\newpage
\bibliography{ice-bib}
\bibliographystyle{siam}

\appendix

\newcommand{\subsect}[1]{\bigskip\subsection{#1}\rule{0mm}{2mm}\par\medskip}
%\newcommand{\subsectstar}[1]{\bigskip\subsection*{#1}\rule{0mm}{2mm}\par\medskip}
\newcommand{\subsectstar}[1]{\bigskip\noindent\textbf{#1.}\rule{0mm}{2mm}\par\medskip}
\newcommand{\subsubsect}[1]{\subsubsection{#1}\rule{0mm}{2mm}\par\smallskip}

\clearpage\newpage
\section{PISM command line options}\label{sect:options}

Much of the behavior of PISM can be set at the command line by options.\ind{PISM!options available at the command line}\ind{options for PISM (and PETSc)!complete list}  For example, the command 

\verb|$  pismv -test C -Mx 61 -e 1.2 -o foo.nc|

\noindent includes four options ``\texttt{-test}'', ``\texttt{-Mx}'', ``\texttt{-e}'', and ``\texttt{-o}'',  The first of these options includes a single character argument, the second an integer argument, the third a floating point argument, and the fourth has a string argument.

The format of the option documentation below is

\centerline{``\large\texttt{-optionname} [\texttt{A}][\texttt{B} \emph{only}]: \quad Description.\normalsize''}

\noindent Here ``A'' is the default value and ``\t{B}'' is a list of the allowed executables.  The option applies to all executables (\texttt{pismr}, \texttt{pisms}, \texttt{pismv}) unless the allowed executables are specifically stated by giving ``[\t{B} \textsl{only}]''.

As PISM is a PETSc program \cite{petsc-user-ref}, all PETSc options are available as well.  The last subsection \ref{subsect:petscoptions} recalls some of these PETSc options.

The Index on page \pageref{sect:index} contains an alphabetical list of options.

\renewcommand{\optindexsection}{Old option index}
\subsect{List of PISM options}

\subsectstar{Options turning on and off major physical models}


\opt{float\_kill}  If ice is (or becomes) floating then it is set to thickness zero.  This is calving at the grounding line.

\opt{hold\_tauc}    Keep the current values of the till yield stress $\tau_c$.  That is, do not update them by the default model using the stored basal melt water.  Only effective if \texttt{-ssa} and \texttt{-plastic} are also set.  See documentation of option \texttt{-plastic} for a description of the till yield stress model.

\opt{no\_mass}  Forces PISM to not change the ice thickness.  No time steps of the mass conservation equation are computed.

\opt{no\_temp}  Force PISM to not change temperature or age values within the ice.  No time steps of the energy conservation and age equations are computed.

\opt{ocean\_kill}  If used with input from a NetCDF initialization file which has ice-free ocean mask (value \texttt{MASK_FLOATING_OCEAN0}$=7$), will zero out ice thicknesses in areas that were ice-free ocean at time zero.  This is calving at the location of the original calving front.  Has no effect when used in conjunction with \texttt{-no_mass}.

\opt{plastic}  Use Schoof's plastic till model for ice streams at all grounded points on the ice sheet.  Must be used along with \texttt{-ssa} to turn on the solution of the SSA (shallow shelf approximation).  See subsection \ref{subsect:plastic}.  See options \texttt{-plastic_reg}, \texttt{-plastic_c0}, \texttt{-plastic_phi}, and \texttt{-plastic_pwfrac}, all of which control the plastic till model in various ways.

Indeed, we describe the role of the parameters for the plastic till model as follows: The effective pressure $N$ on the till is
	$$N = P - p = (1 - (\mathtt{pwfrac}) \lambda) P$$
where $P = \rho g H$ is the overburden or hydrostatic pressure at the base (see Paterson \cite{Paterson}, pp.~168--169) and $p = (\mathtt{pwfrac}) \lambda P$ is the pore water pressure in the till.  Here $\lambda$ is a pure number, $0\le \lambda \le 1$, measuring the amount of available basal water.  In particular, $\lambda = 0$ if the base is frozen, while $\lambda$ is a linear function of the stored basal melt water (see \texttt{-view_map bmelt}), up to the fixed maximum amount of stored basal melt water.  Thus our model says that when there is a lot (the maximum) amount of available basal water, $p= (\mathtt{pwfrac}) P$; the default value for $\mathtt{pwfrac}$ is 0.95.

Note that Paterson gives this formula for the till yield stress
	$$\tau_c = c_0 + \mu N, \qquad \mu = \tan \phi,$$
while Schoof \cite{SchoofStream} formula (2.4) gives this one
	$$\tau_c = \mu N,$$
with zero till cohesion.  We allow a positive till cohesion, though the default is zero, and we describe $\mu$ as the tangent of the friction angle $\phi$.

\opt{ssa}  Use the equations of the shallow shelf approximation \cite{MacAyeal,Morland,SchoofStream,WeisGreveHutter} for ice shelves and dragging ice shelves (i.e.~ice streams) where so-indicated by the mask.  To view the mask use \texttt{-view_map mask}.  See also \texttt{-plastic} and \texttt{-super}. See also \texttt{-dontreadSSAvels}.

\opt{super}  Combine the velocity fields from the SIA and SSA models as in \cite{BBssasliding}.  Only effective if used with \texttt{-ssa}.


\subsectstar{Options controlling input and output behavior of PISM}

\subsubsect{File input and output from PISM}

\opt{boot\_from}  The model can be ``bootstrapped'' from certain NetCDF files using less than the full initial values for the system of evolution partial differential equations.  See sections \ref{sect:boot} for generalities and \ref{sec:eismint-greenland} for an example.  Compare \texttt{-i}.

\opt{dSLforcing}    Use the specified NetCDF file to apply changes in \emph{S}ea \emph{L}evel from a climate ``forcing'' record.  See section \ref{sec:eismint-greenland} for an example.

\opt{dTforcing}    Use the specified NetCDF file to apply changes in surface \emph{T}emperature from a climate ``forcing'' record.  See section \ref{sec:eismint-greenland} for an example.

\opt{f3d}  Save the model state with additional full velocity field.  That is, save all scalar components $u(x,y,z)$, $v(x,y,z)$, $w(x,y,z)$ of the velocity field for $(x,y,z)$ everywhere in the three-dimensional computational box.  These are saved as \texttt{uvel}, \texttt{vvel}, and \texttt{wvel}, respectively.  Also saves \texttt{uvelsurf} and \texttt{vvelsurf}, the surface values of the $x$ and $y$ components of the velocity.

Has the effect of (very roughly) doubling the size of the output model state NetCDF file.

\opt{i}  The model can be initialized (restarted) from a NetCDF file \texttt{foo.nc} written by the model, e.g.~\texttt{foo.nc} from \texttt{-o foo.nc}.  Compare \texttt{-boot_from}.

\opt{o}  Give name of output file: \texttt{-o foo.nc} writes an output file named \texttt{foo.nc}.  See the description of option \texttt{-i}.  Default name is \texttt{unnamed.nc} under \texttt{pismr}, \texttt{simp_exper.nc} under \texttt{pisms}, and \texttt{verify.nc} under \texttt{pismv}.

\opt{regrid\_from}  Give the name of the NetCDF file from which to regrid variables.  See section \ref{sec:practical-usage}.

\optdef{regrid\_vars}{}  Which variables to regrid.  See section \ref{sec:practical-usage}.

\opt{dontreadSSAvels} Turns off reading the \texttt{ubarSSA} and \texttt{vbarSSA} velocities saved by a previous \texttt{-ssa} run.

\opt{save\_file} Give the name of the NetCDF file to which to save PISM model states
(snapshots).  Requires setting \texttt{-save_times}.  Saving the
snapshots \emph{does not} affect the time-stepping determined by the adaptive
scheme.

For example,
\begin{verbatim}
$ pismv -test G -y 1000 -save_file foo.nc -save_times 0:100:900 -o bar.nc
\end{verbatim}
produces two files.  File \texttt{foo.nc} has snapshots at 10 times, each a time 
following a regular PISM timestep.  File \texttt{bar.nc} has the final PISM state,
at time 1000.0 in this case.

Note that in presence of the \texttt{-split_snapshots} option
\texttt{-save_file} value is interpreted as a \emph{basename}. That is,
\begin{verbatim}
$ pismv -test G -y 1000 -save_file foo -save_times 0:100:900 -split_snapshots
\end{verbatim}
will produce files with names such as \texttt{foo-000112.nc}.

Compare option \texttt{-o} which merely saves the final state.  
See section \ref{sec:snapshots} for more details. 

\opt{save\_times} Used in combination with option \texttt{-save_file} above.
Takes two kinds of input: either a MATLAB-style range in the form
$t_{0}:\Delta t:t_{f}$ or a comma-separated list of times in years.  The
comma-separated list above can be at most 200 numbers long.

Saving the snapshots \emph{does not} affect the time-stepping determined 
by the adaptive scheme.  As a result, snapshots are saved
\emph{on the first time-step after the time requested}, and there is
no guarantee of producing the exact number of snapshots requested.

For example, if in a particular run PISM uses time-steps of
60 years, then \texttt{-save_times 50,80,100} might produce snapshots at 60 and 120
years if 0.0, 60.0, 120.0, \dots were the usual PISM timesteps.

See section \ref{sec:snapshots} for more details.

\opt{split\_snapshots} Save model state snapshots to separate files. See the
\texttt{-save_file} option documentation above for details.

\subsubsect{Verbosity to standard out}

\optdef{verbose}{2}   Increased verbosity of standard output.  Usually given with an integer level; 0,1,2,3,4,5 are allowed.  At the extremes, \texttt{-verbose 0} produces no stdout at all, \texttt{-verbose 1} only prints only warnings and a few high priority messages, and \texttt{-verbose 5} spews a lot of usually-undesirable stuff.  If given without argument (``\texttt{-verbose}'') then sets level 3, while ``\texttt{-verbose 2}'' is the default.

\subsectstar{Options controlling parameters for physical models}

\subsubsect{Flow and dynamical parameters}

\optdef{constant\_nuH}{30.0}  If this option is used then the velocities in ice shelves and streams (see \texttt{-ssa} below) are computed with a constant value for the product of viscosity $\nu$ and thickness $H$, obtained from the shelf extension (see \texttt{-shelfxt}).  This is useful for debugging ice-shelf flow because there is reduces the membrane stress to a linear constant-coefficient term rather than a fully nonlinear one.  The argument is given in units of MPa a, and the default value is $30$ MPa a, the value given in \cite{Ritzetal2001}.

\optdef{e}{1.0}  Flow enhancement factor.

\optdef{gk}{1.0}  Sets the flow law used in computing SIA velocity to Goldsby-Kohlstedt \cite{GoldsbyKohlstedt} and uses a constant grain size.  The option \texttt{-gk} without an argument uses default grain size of 1 mm while \texttt{-gk N} uses \texttt{N} mm grains.  See \texttt{-ice_type} for more complete option choice of flow law.

\opt{gk\_age}  Sets the flow law used in computing SIA velocity to Goldsby-Kohlstedt \cite{GoldsbyKohlstedt}, but uses the modeled age to compute the grain size; compare \texttt{-gk}.  The age is used in a table from the Vostok core \cite{VostokCore} to compute a grain size.  This option should not be used unless the model age has stabilized after a long (e.g.~$\ge 100$ ka) run.

\optdef{ice\_type}{pb}  Allows choice of ice rheology, also known as the ``flow law''.  The options are in table \ref{tab:flowlaw} below.  Note that a ``flow law'' here means the function $F(\sigma,T,P,d)$ in the relation
	$$\dot \eps_{ij} = F(\sigma,T,P,d)\, \sigma_{ij}'$$
where $\dot \eps_{ij}$ is the strain rate tensor, $\sigma_{ij}'$ is the stress deviator tensor, $T$ is the ice temperature, $\sigma^2 = \frac{1}{2} \|\sigma_{ij}'\|_F$ so $\sigma$ is the second invariant of the stress deviator tensor, $P$ is the pressure, and $d$ is the grain size.  That is, we are addressing isotropic flow laws only, and one can choose the scalar function.  Note that the inverse form of such a flow law in needed for ice shelves and ice streams:
	$$\sigma_{ij}' = 2 \nu(\dot\eps,T,P,d)\,\dot \eps_{ij} $$
Here $\nu(\dot \eps,T,P,d)$ is the effective viscosity.  The need for this inverse form of the flow law explains the ``hybrid'' law \texttt{-ice_type hybrid} (or \texttt{-gk}).

\optdef{ice\_custom\_hardness}{1.9e8} Some ice types are customizable, run with \texttt{-help} to see all the customizable options for your chosen ice type (since \texttt{-help} displays many options, it is often useful to grep the output, as in \verb:pisms -ice_type custom -help | grep ice_:).  A common use the \texttt{custom} ice type is to directly specify the hardness parameter in an ice shelf study.  The viscous stress term in the $x$-component (for example) of the SSA equations for ice shelves and ice streams is
	$$\ddx{}\left(2\nu H\left(2\ddx{u} + \ddy{v}\right)\right)$$
where 
	$$\nu = \frac{\bar B}{2} \left[\left(\ddx{u}\right)^2 + \left(\ddy{v}\right)^2 +
  \frac{1}{4} \left(\ddy{u} + \ddx{v}\right)^2 + \ddx{u}\ddy{v}\right]^{(1-n)/(2n)}.$$
Generally $\bar B$ is computed by a vertical-integral of a function of the temperature field, but it is constant for isothermal ice.  If \texttt{-ice_custom_hardness} is used then $\bar B$ is set to the given value.  The value should have units of Pa $\text{s}^{1/n}$ where $n$ is the Glen exponent (see \texttt{-ice_type}).  Note that \texttt{-ice_type} is \texttt{pb} (Paterson-Budd) by default for most runs so \texttt{-ice_custom_hardness} is only available when \texttt{-ice_type custom} is given or when the driver has changed the default ice type (such as with \texttt{pismv -test I} and \texttt{pross}).

In the case of \texttt{pross}, which performs the EISMINT Ross ice shelf intercomparison, a constant value $\bar B = 1.9 \times 10^8 \, \text{Pa}\, \text{s}^{1/3}$ is the default \cite{MacAyealetal}.

\begin{table}[ht]
\caption{Choosing the rheology using \t{-ice\_type}.}\label{tab:flowlaw}\ind{rheology}\ind{flow law}
\small
\begin{tabular}{p{0.25\linewidth}p{0.08\linewidth}p{0.57\linewidth}}\hline
\textbf{Flow Law} & \textbf{Type} & \textbf{Comments and Reference} \\ \hline
Paterson-Budd law (usually the default)  &  \t{pb} &   Fixed Glen exponent $n=3$.  There is a split ``Arrhenius'' term $A(T) = A \exp(-Q/RT^*)$ where \mbox{$A = 3.615 \times 10^{-13}\, \text{s}^{-1}\, \text{Pa}^{-3}$}, \mbox{$Q = 6.0 \times 10^4\, \text{J}\, \text{mol}^{-1}$} if $T^* < 263$ K and
 \mbox{$A = 1.733 \times 10^{3}\, \text{s}^{-1}\, \text{Pa}^{-3}$}, \mbox{$Q = 13.9 \times 10^4\, \text{J}\, \text{mol}^{-1}$} if $T^* > 263$ K and where $T^*$ is the pressure-adjusted temperature \cite{PatersonBudd}. \\
\emph{Cold} part of Paterson-Budd &  \t{arr} &   Regardless of temperature, the $A$ and $Q$ values for $T^*<263$ K in  the Paterson-Budd law apply.  This is the flow law used in the thermomechanically coupled exact solutions Tests \textbf{F} and \textbf{G} described in \cite{BBL,BB} and run by \texttt{pismv -test F} and \texttt{pismv -test G}. \\

\emph{Warm} part of Paterson-Budd     &  \t{arrwarm} & Regardless of temperature, the $A$ and $Q$ values for $T^*>263$ K in Paterson-Budd apply.\\
Hooke law   &  \t{hooke} &  Fixed Glen exponent $n=3$.  Here  $A(T) = A \exp(-Q/(RT^*) + 3C (T_r - T^*)^\kappa)$; values of  constants as in \cite{Hooke,PayneBaldwin}.\\
Hybrid of Goldsby-Kohlstedt and Paterson-Budd & \t{hybrid} &     Goldsby-Kohlstedt law with a combination of exponents  from $n=1.8$ to $n=4$ \cite{GoldsbyKohlstedt} in grounded  shallow ice approximation regions.  Paterson-Budd flow  for ice streams and ice sheets. See mask for SIA versus stream versus shelf by \texttt{-view_map mask}. \\
Isothermal Glen & \t{custom} & Highly customizable version of the isothermal Glen flow law.  Allows choice of exponent, hardness/softness parameters, and density. \\
\hline
\normalsize	
\end{tabular}
\end{table}

\begin{comment}
\opt{shelfext\und} When computing ice shelf and stream velocity, PISM enforces boundary conditions using a fictitious extension of the ice shelf over the entire domain.  This extension provides strength only, it does not change the mass, driving force, or location of the calving front.  By default, it's strength will be computed using the current ice type at reference thickness, temperature, and strain rate, customizable using \texttt{-shelfext_H} (5 meters by default), \texttt{-shelfext_T} (263.15 K), \texttt{-shelfext_Du} (1 m/a per km).  The extension strength is used whenever ice thickness is less than the extension thickness to prevent the equations from becoming singular.  You can also specify the extension strength directly using \texttt{-shelfext_force_nuH} with units in Pa s.  Finally, you can compute strength using a \texttt{custom} ice type the ice used in the rest of PISM by giving \texttt{-shelfext_use_private_ice}.  This option will gives you a \texttt{custom} ice type which you can control via \texttt{-shelfext_ice_custom_} (see \texttt{-ice_type}).  All \texttt{-shelfext} options are displayed in \texttt{-help}.
\end{comment}

\optdef{mu\_sliding}{0}  The sliding law parameter in SIA regions of the ice.  \emph{This kind of sliding is not recommended, which is why it is turned off by default.  See} \texttt{-ssa} \emph{and} \texttt{-plastic} \emph{for the recommended sliding model.}  This kind of sliding is used in experiments G and H of EISMINT II \cite{EISMINT00}, but note that executable \texttt{pisms -eisII} ignors this parameter and uses the right amount of sliding for the given experiment.

\opt{surf\_vel\_to\_phi}  Computes till friction angle $\phi$=\texttt{tillphi} by inverting provided surface velocities in file.  Under development.  See \emph{Reference Manual} and source files \texttt{iMinverse.cc,iMinverseMat.cc}.

\optdef{topg\_to\_phi}{5.0,15.0,-1000.0,1000.0,10.0}  Sets till friction angle $\phi$=\texttt{tillphi} to piecewise-linear function of bed elevation.  Takes zero to five comma-separated arguments.  An example, in which sliding happens in the ``trough'', is 

\begin{verbatim}
pisms -eisII I -ssa -super -plastic -track_Hmelt -Mx 91 -My 91 -Mz 51 \
      -topg_to_phi 5.0,15.0,0.0,1000.0 -y 12000
\end{verbatim}
\noindent See \emph{Reference Manual}, source file \texttt{iMbasal.cc}, and \cite{BBssasliding}.

\subsubsect{Plastic till model parameters}

\optdef{plastic\_c0}{0.0}  Set the value of the till cohesion in the plastic till model.  The value is a pressure, given in kPa.  Only effective if used with \texttt{-plastic} and \texttt{-ssa}.

Note Schoof \cite{SchoofStream} formula (2.4) uses $c_0 = 0$.

\optdef{plastic\_pwfrac}{0.95}  Set what fraction of overburden pressure is assumed as the till pore water pressure.  Only relevant at basal points where there is a positive amount of basal water.  The value is a pure number.  Only effective if used with \texttt{-plastic} and \texttt{-ssa}.

\optdef{plastic\_reg}{0.01 m/a}    Set the value of $\eps$ regularization of plastic till; this is the second ``$\eps$'' in formula (4.1) in \cite{SchoofStream}.  Only effective if used with \texttt{-plastic} and \texttt{-ssa}.

\optdef{plastic\_phi}{30.0}  Set the till friction angle.  The value is an angle $\phi$, given in degrees, and the coefficient $\mu$ in formula (2.4) in \cite{SchoofStream} is computed from $\theta$ by this formula:
	$$\mu = \tan\left(\frac{\pi}{180} \theta\right).$$
Only effective if used with \texttt{-plastic} and \texttt{-ssa}.


\subsectstar{Options controlling numerical methods}

\subsubsect{General methods}

\optdef{adapt\_ratio}{0.12}  Adaptive time stepping ratio for the explicit scheme for the mass balance equation.

\opt{eta}  The surface gradient is usually computed in the obvious way by finite differences applied to the surface elevation $h$.  Specifically, we use the Mahaffy \cite{Mahaffy} scheme.  Alternatively, if this option is set we first transform the thickness $H$ by $\eta = H^{(2n+2)/n}$ and then differentiating the sum of the thickness and the bed:
	$$\grad h = \grad H + \grad b = \frac{n}{(2n+2)} \eta^{(-n-2)/(2n+2)} \nabla \eta + \nabla b.$$
Here $b$ is the bed elevation and $h$ is the surface elevation.  The transformation sometimes has the benefits that the surface values of the horizontal velocity and vertical velocity, and the driving stress, are better behaved near the margin.  See \cite{CDDSV} for the technical explanation of this transformation and compare \cite{SaitoMargin}.

\optdef{low\_temp}{200.0}  Set the temperature which PISM will regard as ``too low''.  Units in Kelvin.  Note that one kind of numerical error associated to the advection part of the conservation of energy scheme is for the maximum principle to be violated.  In that case temperatures appear at the next step which are outside the range of current temperatures.  PISM attempts to count such violations, and if the number is too great then the run is stopped.  See option \texttt{-max_low_temps}.

\optdef{max\_dt}{60.0}  The maximum time-step in years.  The adaptive time-stepping scheme will make the time-step shorter than this as needed for stability, but not longer.  See section \ref{sec:practical-usage}.

\optdef{max\_low\_temps}{10}  Specify the number (a nonnegative integer) of allowed low temp violations per time step.  Note these are reported in detail (i.e.~with location) if \texttt{-verbose} is set.  Note that one kind of numerical error associated to the advection part of the conservation of energy scheme is for the maximum principle to be violated.  In that case temperatures appear at the next step which are outside the range of current temperatures.  PISM attempts to count such violations, and if the number is too great then the run is stopped.  See option \texttt{-low_temp} for the cutoff low temperature.

\optdef{skip}{10}  Number of mass-balance steps, including SIA diffusivity updates, to perform before a the temperature, age, and SSA stress balance computations are done.  This is only effective if the time step is being limited by the diffusivity time step restriction associated to mass continuity using the SIA.  The maximum recommended value for \texttt{-skip} is, unfortunately, dependent on the context.  The temperature field should be updated when the surface changes significantly, and likewise the basal sliding velocity if it comes (as it should) from the SSA calculation.


\subsubsect{Shelf and stream numerical method}

\optdef{ice\_reg\_schoof\_length}{1000 km}  Set the ``$L$'' in formula (4.1) in \cite{SchoofStream}.  To use the regularization described by Schoof, one must set \texttt{-ssa_eps 0.0} to turn off the other regularization mechanism, otherwise there is a double regularization (the default except in \texttt{pism -test I}).

\optdef{ice\_reg\_schoof\_vel}{1 m/a}  Set the \emph{first} ``$\eps$'' in formula (4.1) in \cite{SchoofStream}.  To deactivate Schoof's regularization, use \texttt{-ice_reg_schoof_vel 0}.  To use the regularization described by Schoof, one must set \texttt{-ssa_eps 0.0} to turn off the other regularization mechanism, otherwise there is a double regularization (the default except in \texttt{pismv -test I}).  Use \texttt{-plastic_reg} above to set the second ``$\eps$'' in formula (4.1) of \cite{SchoofStream}.

\opt{shelves\_drag\_too}  Ice streams are modeled as ``dragging ice shelves'' in PISM, as in either linear \cite{MacAyeal} or plastic \cite{SchoofStream} or pseudo-plastic basal resistance, according to options.  If this option is turned on then the floating ice shelves also have very slight resistance, according to a linear model $\tau_b = \beta u$ where $\beta = 1.8\times 10^5\, \text{Pa}\,\text{s}\,\text{m}^{-1}$.  This value is $10^4$ times smaller than the representative drag coefficient given for ice stream E in \cite{HulbeMacAyeal}.  Ice shelves usually have precisely zero basal resistance, but nonzero drag for the ice shelf is turned on by default in MISMIP; see section \ref{sect:simp}.

\optdef{ssa\_eps}{1e-15} The numerical scheme for the shallow shelf approximation  \cite{WeisGreveHutter} computes an effective viscosity which which depends on velocity and temperature.  After that computation, this constant is added to the effective viscosity (to keep it bounded away from zero).  The units are kg $\text{m}^{-1}\,\text{s}^{-1}$.  By default, the regularization in equation (4.1) of \cite{SchoofStream} is also active, use \texttt{-ice_reg_schoof_vel 0} to deactivate Schoof's regularization. Turn off this lower bound mechanise by \texttt{-ssa_eps 0.0} to exclusively use the Schoof regularization mechanism; see \texttt{-ice_reg_schoof_vel} and \texttt{-ice_reg_schoof_length} below.  Note \texttt{-ssa_eps} is set to zero automatically when running \texttt{pismv -test I}.

\begin{comment}
\opt{ssa\_external} We are experimenting with other solvers for the stream and shelf equations.  If given, this option exposes these experimental solvers.  Run with \verb:-ssa_external -help | grep ssa_: to see what options are available.
\end{comment}

\optdef{ssa\_maxi}{300}  This option sets the maximum allowed number of nonlinear iterations in solving the shallow shelf approximation.  One should usually use option \texttt{-ssa_rtol} to control convergence of the nonlinear iteration.

\optdef{ssa\_rtol}{1.0e-4}  The numerical scheme for the shallow shelf approximation \cite{WeisGreveHutter} does a nonlinear iteration wherein velocities (and temperatures) are used to compute a vertically-averaged effective viscosity which is used to solve the equations for horizontal velocity.  Then the new velocities are used to recompute an effective viscosity, and so on.  This option sets the relative change tolerance for the effective viscosity.

In particular, the nonlinear part of the iteration requires that successive values $\nu^{(k)}$ of the vertically-averaged effective viscosity satisfy
	$$\frac{\|(\nu^{(k)} - \nu^{(k-1)}) H\|_2}{\|\nu^{(k)} H\|_2} \le \text{ssa\_rtol}$$
in order to end the iteration with $\nu = \nu^{(k)}$.  See also \texttt{-ksp_rtol}, a PETSc option below, as one may want to require a high relative tolerance for the linear iteration as well.


\subsectstar{Options special to verification and simplified geometry cases}


\subsubsect{Verification}

\optrestrict{no\_report}{pismv}  Do not report errors at the end of a verification run.

\optrestrict{eo}{pismv}  Only evaluate the exact solution (don't do numerical approximation at all).  See section \ref{sect:verif}.

\optdefrestrict{test}{A}{pismv}  Choose which verification test to run by giving its single character name.  See section \ref{sect:verif}.


\subsubsect{EISMINT II}

\optrestrict{bmr\_in\_cont}{pisms -eisII}  By default PISM includes the basal melt rate in the continuity equation.  The EISMINT II experiments specify that it should not be included \cite{EISMINT00}, so the default behavior of \texttt{pisms -eisII} is to not include it.  This option makes \texttt{pisms -eisII} behave like the generic PISM cases (e.g.~\texttt{pismr}).

\optdefrestrict{eisII}{A}{pisms}  Choose single character name of EISMINT II \cite{EISMINT00} simplified geometry experiment.  Allowed values are A, B, C, D, E, F, G, H.

\optrestrict{Mmax}{pisms -eisII}  Set value of $M_{\text{max}}$ for EISMINT II.

\optrestrict{Rel}{pisms -eisII}    Set value of $R_{\text{el}}$ for EISMINT II.

\optrestrict{Sb}{pisms -eisII}    Set value of $S_b$ for EISMINT II.

\optrestrict{ST}{pisms -eisII}    Set value of $S_T$ for EISMINT II.

\optrestrict{Tmin}{pisms -eisII}    Set value of $T_{\text{min}}$ for EISMINT II.

\optrestrict{track\_Hmelt}{pisms -eisII}    Turn on the part of the conservation of energy model which accumulates (tracks) locally-stored basal melt water.

% FIXME: describe the pross driver.
% \optrestrict{ross}{pismd}    Run the EISMINT Ross ice shelf validation \cite{MacAyealetal}.  Requires data from \url{http://homepages.vub.ac.be/~phuybrec/eismint/iceshelf.html}.


\subsect{PETSC options for PISM users}\label{subsect:petscoptions}
\renewcommand{\optindexsection}{PETSc options for PISM users}

All PETSc programs accept command line options which control how PETSc distributes jobs among parallel processors, how it solves linear systems, what additional information it provides, and so on.  The PETSc manual \cite{petsc-user-ref} is the complete reference on these options.  We list some here that are useful to PISM users.  They can be mixed in any order with PISM options.

Both for PISM and PETSc options, there are ways of avoiding the inconvenience of long commands with many runtime options.  Obviously, and as illustrated by examples in the previous sections, shell scripts can be set up to run PISM.  But PETSc also provides two mechanisms to give runtime options without retyping at each run command.

First, the environment variable \texttt{PETSC_OPTIONS} can be set.  For example, a sequence of runs might need the same refined grid, and you might want to know if other options are read, ignored, or misspelled.  Set (in bash):

\texttt{export PETSC_OPTIONS="-Mx 101 -My 101 -Mz 51 -options_left"}

\noindent The runs 
\begin{verbatim}
$ pismv -test F -y 100
$ pismv -test G -y 100
\end{verbatim}
\noindent then have the same refined grid in each run, and the runs report on which options were read.

Second, the file \texttt{.petscrc} is always read, if present, from the directory where PISM (i.e.~the PETSc program) is started.  It can have a list of options, one per line.  For example, to get the same options as above, \texttt{.petscrc} would contain these lines:
\begin{verbatim}
-Mx 101
-My 101
-Mz 51
-options_left
\end{verbatim}
\noindent Note that the first four lines give PISM options while the last has a generic PETSc option.

These two PETSc mechanisms can be used together.  (The effect of duplicate or conflicting options is not clear, however, and should be avoided.)
\bigskip

% "-da_processors_x M -da_processors_y N" should not be documented in this sub-appendix
% because they do not work.  the reason is that IceModelVec2 and IceModelVec3 put 
% the Mx, My dimensions in different arguments to the DACreate commands

\opt{display}  The option \texttt{-display :0} seems to frequently be needed to let PETSc use Xwindows when running multiple processes.  \emph{It must be given as a \emph{final} option, after all the others.}

\opt{help}  Gives PISM help message and then a brief description of many PETSc options.

\opt{info}  Gives excessive information about PETSc operations during run.  Option \texttt{-verbose} for PISM (above) is generally more useful, except possibly for debugging.

\optdef{ksp\_rtol}{1e-5}  For solving the SSA equations with high resolution on multiple processors, it is recommended that this be tightened (set lower than the default).  For example, 

\verb|$  mpiexec -n 8 pismv -test I -Mx 5 -My 769|

\noindent works poorly on a certain machine, but

\verb|$  mpiexec -n 8 pismv -test I -Mx 5 -My 769 -ksp_rtol 1e-10|

\noindent works fine.

\optdef{ksp\_type}{gmres}  Based on one processor evidence from \texttt{pismv -test I}, the following are possible choices in the sense that they work and allow convergence at some reasonable rate: \t{cg}, \t{bicg}, \t{gmres}, \t{bcgs}, \t{cgs}, \t{tfqmr}, \t{tcqmr}, and \t{cr}.  It appears \t{bicg}, \t{gmres}, \t{bcgs}, and \t{tfqmr}, at least, are all among the best.

\opt{log\_summary}  At the end of the run gives a performance summary and also a synopsis of the PETSc configuration in use.

\opt{options\_left}  Shows an options table which will indicate if a user option was not read or was misspelled.

\optdef{pc\_type}{ilu}   Several options are possible, but for solving the ice stream and shelf equations we recommend only \t{bjacobi}, \t{ilu}, and \t{asm}.  Of these it is not currently clear which is fastest; they are all about the same for \texttt{pismv -test I} with high tolerances (e.g.~\texttt{-ssa_rtol 1e-7} \texttt{-ksp_rtol 1e-12}).

\opt{v}   Show version number of PETSc.



\label{sect:index}
\Printindex{general}{General Index}
\Printindex{options}{PISM Command-line Options}


\end{document}
